jQuery(function(a){function b(){a(".tabify_control ul").sortable({connectWith:".tabify_control ul",scroll:!1,disableSelection:!0,receive:function(b,c){var d=a(c.item),e=d.closest("div");if(e.data("id"))var f=e.data("id");else var f=e.index();var g=a("input",c.item).attr("name").split("][");g[3]=f,a("input",c.item).attr("name",g.join("]["))}})}function c(){a(".tabifybox:visible .tabify_tab").each(function(b){var c=a(this).index(),d=a("h2 input",this).attr("name").split("][");d[3]=c,a("h2 input",this).attr("name",d.join("][")),a(this).find(".ui-sortable").children().each(function(b){var d=a("input",this).attr("name").split("][");d[3]=c,a("input",this).attr("name",d.join("]["))})})}function d(){var b=a(".tabifybox:visible .tabify_control").children().length;1>=b&&a(".tabifybox:visible .tabify-remove-tab").fadeOut()}a(".tabify_control .item-order").remove(),a("#tabify_edit_screen_nojs").remove(),a(".tabify_control").sortable({scroll:!1,update:function(a,b){c()}}),b(),a("#create_tab").on("click",function(c){c.preventDefault(),a(".tabifybox:visible .tabify-remove-tab").fadeIn();var d=a("#tabify-submenu .nav-tab-active").attr("id");d=d.replace("tab-","");var e=a(".tabifybox-"+d+" .tabify_control").children().length,f=wp.template("new-tab"),g={tab_id:e,section:d};a(".tabifybox-"+d+" .tabify_control").append(f(g)),a(".tabifybox-"+d+" .tabify_control").sortable("refresh"),b()}),a(document).on("click",".tabifybox h2",function(){a("span",this).hide(),a("input",this).show(),a("input",this).focus()}),a(document).on("focusout",".tabifybox h2 input",function(){a(this).hide(),a(this).closest("h2").find("span").html(a(this).val()),a(this).closest("h2").find("span").show()}),a(document).on("click",".tabify-remove-tab",function(b){if(b.preventDefault(),1==a(this).css("opacity")){var c=a(this).closest(".tabify_tab"),e=c.find(".ui-sortable").children().length;if(0==e)c.hide(function(){a(this).remove(),d()});else{a(this).hide();var f='<div class="tabify-remove-accept">'+tabify_l10.move_meta_boxes+" <select>";a(".tabifybox:visible .tabify_tab").each(function(b){a(this).is(c)||(f+='<option value="'+b+'">'+a(this).find("h2").text()+"</option>")}),f+="</select>",f+=' <input type="button" class="button" value="'+tabify_l10.remove+'" />',f+=' &nbsp; <a href="">'+tabify_l10.cancel+"</a>",f+="</div>",a(f).insertAfter(this).show("blind")}}}),a(document).on("click",".tabify-remove-accept input",function(b){var e=a(this).closest(".tabify_tab"),f=a(this).closest(".tabify_control").children().eq(e.find("select option:selected").val()).find(".ui-sortable");e.hide(function(){e.find(".ui-sortable").children().each(function(b){a(this).hide(),f.append(this),a(this).show("blind")}),a(this).remove(),c(),d()})}),a(document).on("click",".tabify-remove-accept a",function(b){b.preventDefault();var c=a(this).closest(".tabify_tab");c.find(".tabify-remove-accept").hide("blind",function(){a(this).remove(),c.find(".tabify-remove-tab").fadeIn(),a(c).trigger("tabify-declined-remove-tab")})})});