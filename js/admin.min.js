jQuery(function(t){function i(){t(".tabify_control ul").sortable({connectWith:".tabify_control ul",scroll:!1,disableSelection:!0,receive:function(i,e){var n=t(e.item),a=n.closest("div");if(a.data("id"))var o=a.data("id");else var o=a.index();var c=t("input",e.item).attr("name").split("][");c[3]=o,t("input",e.item).attr("name",c.join("]["))}})}function e(){t(".tabifybox:visible .tabify_tab").each(function(i){var e=t(this).index(),n=t("h2 input",this).attr("name").split("][");n[3]=e,t("h2 input",this).attr("name",n.join("][")),t(this).find(".ui-sortable").children().each(function(i){var n=t("input",this).attr("name").split("][");n[3]=e,t("input",this).attr("name",n.join("]["))})})}function n(){var i=t(".tabifybox:visible .tabify_control").children().length;1>=i&&t(".tabifybox:visible .tabify-remove-tab").fadeOut()}t(".tabify_control .item-order").remove(),t("#tabify_edit_screen_nojs").remove(),t(".tabify_control").sortable({scroll:!1,update:function(t,i){e()}}),i(),t("#create_tab").on("click",function(e){e.preventDefault(),t(".tabifybox:visible .tabify-remove-tab").fadeIn();var n=t("#tabify-submenu .nav-tab-active").attr("id");n=n.replace("tab-","");var a=t(".tabifybox-"+n+" .tabify_control").children().length,o=wp.template("new-tab"),c={tab_id:a,section:n};t(".tabifybox-"+n+" .tabify_control").append(o(c)),t(".tabifybox-"+n+" .tabify_control").sortable("refresh"),i()}),t(document).on("click",".tabifybox h2",function(){t("span",this).hide(),t("input",this).show(),t("input",this).focus()}),t(document).on("focusout",".tabifybox h2 input",function(){t(this).hide(),t(this).closest("h2").find("span").html(t(this).val()),t(this).closest("h2").find("span").show()}),t(document).on("click",".tabify-remove-tab",function(i){if(i.preventDefault(),1==t(this).css("opacity")){var e=t(this).closest(".tabify_tab"),a=e.find(".ui-sortable").children().length;if(0==a)e.hide(function(){t(this).remove(),n()});else{t(this).hide();var o='<div class="tabify-remove-accept">'+tabify_l10.move_meta_boxes+" <select>";t(".tabifybox:visible .tabify_tab").each(function(i){t(this).is(e)||(o+='<option value="'+i+'">'+t(this).find("h2").text()+"</option>")}),o+="</select>",o+=' <input type="button" class="button" value="'+tabify_l10.remove+'" />',o+=' &nbsp; <a href="">'+tabify_l10.cancel+"</a>",o+="</div>",t(o).insertAfter(this).show("blind")}}}),t(document).on("click",".tabify-remove-accept input",function(i){var a=t(this).closest(".tabify_tab"),o=t(this).closest(".tabify_control").children().eq(a.find("select option:selected").val()).find(".ui-sortable");a.hide(function(){a.find(".ui-sortable").children().each(function(i){t(this).hide(),o.append(this),t(this).show("blind")}),t(this).remove(),e(),n()})}),t(document).on("click",".tabify-remove-accept a",function(i){i.preventDefault();var e=t(this).closest(".tabify_tab");e.find(".tabify-remove-accept").hide("blind",function(){t(this).remove(),e.find(".tabify-remove-tab").fadeIn(),t(e).trigger("tabify-declined-remove-tab")})})});